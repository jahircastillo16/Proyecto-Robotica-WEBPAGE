<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grafico de Temperatura</title>
    <script defer src="https://unpkg.com/alpinejs@3.10.2/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css" />
    <link rel="stylesheet" type="text/css" href="../css/graficas.css">
    <style>
        /* Add your custom CSS here */
    </style>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
</head>
<body>
    <main class="min-h-screen w-full bg-gray-100 text-gray-700" x-data="layout">
        <!-- header page -->
        <header class="flex w-full items-center justify-between border-b-2 border-gray-200 bg-white p-2">
            <!-- logo -->
            <div class="flex items-center space-x-2">
                <button type="button" class="text-3xl" @click="asideOpen = !asideOpen"><i class="bx bx-menu"></i></button>
                <div>Menu</div>
            </div>
            <!-- button profile -->
            <div>
                <div class="imagenPerfil">
                    <button type="button" @click="profileOpen = !profileOpen" @click.outside="profileOpen = false"
                        class="h-9 w-9 overflow-hidden rounded-full">
                        <img id="imagen" alt="plchldr.co" />
                        <!-- el id imagen sirve para extraer la imagen de perfil del que inicio sesion usando la cookie -->
                    </button>
                </div>
                <!-- dropdown profile -->
                <div class="absolute right-2 mt-1 w-48 divide-y divide-gray-200 rounded-md border border-gray-200 bg-white shadow-md"
                    x-show="profileOpen" x-transition>
                <div class="flex items-center space-x-2 p-2">
                    <img src="https://plchldr.co/i/40x40?bg=111111" alt="plchldr.co" class="h-9 w-9 rounded-full" />
                    <!-- el id usernamedisplay es para mostrar el nombre de la persona que inicio sesion usando la cookie -->
                    <div class="font-medium" id="usernameDisplay">No has iniciado sesión uwu</div>
                </div>
                    <div class="flex flex-col space-y-3 p-2">
                        <a href="perfil.html" class="transition hover:text-blue-600">Mi Perfil</a>
                        <a href="editar.html" class="transition hover:text-blue-600">Editar Perfil</a>
                        <a href="#" class="transition hover:text-blue-600">Configuración</a>
                    </div>
                    <div class="p-2">
                        <a href="../index.html" class="flex items-center space-x-2 transition hover:text-blue-600">
                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1">
                                </path>
                            </svg>
                            <div>Salir</div>
                        </a>
                    </div>
                </div>
            </div>
        </header>
        <div class="flex">
            <!-- aside -->
            <aside class="flex w-72 flex-col space-y-2 border-r-2 border-gray-200 bg-white p-2" style="height: 90.5vh"
                x-show="asideOpen">
                <a href="pagina_principal.html" class="flex items-center space-x-1 rounded-md px-2 py-3 hover:bg-gray-100 hover:text-blue-600">
                    <span class="text-2xl"><i class="bx bx-home"></i></span>
                    <span>Inicio</span>
                </a>
                <a href="#" class="flex items-center space-x-1 rounded-md px-2 py-3 hover:bg-gray-100 hover:text-blue-600">
                    <span class="text-2xl">
                        <img src="../imagenes/graficas.png" width="24" height="25" alt="Gráficos" />
                    </span>
                    <span>Graficas</span>
                </a>
                <a href="#" class="flex items-center space-x-1 rounded-md px-2 py-3 hover:bg-gray-100 hover:text-blue-600">
                    <span class="text-2xl">
                        <img src="../imagenes/agregar.png" width="24" height="25" alt="Anadir" />
                    </span>
                    <span>Añadir AC</span>
                </a>
                <a href="#" class="flex items-center space-x-1 rounded-md px-2 py-3 hover:bg-gray-100 hover:text-blue-600">
                    <span class="text-2xl">
                        <img src="../imagenes/eliminar.png" width="24" height="25" alt="Eliminar" />
                    </span>
                    <span>Borrar AC</span>
                </a>
                <a href="perfil.html" class="flex items-center space-x-1 rounded-md px-2 py-3 hover:bg-gray-100 hover:text-blue-600">
                    <span class="text-2xl"><i class="bx bx-user"></i></span>
                    <span>Perfil</span>
                </a>
            </aside>
            <!-- main content page -->
        <div class="card">
            <div class="titulo">
                <h2>Grafica de Temperatura</h2>
            </div>
            <div class="datos">
                <canvas id="myChart" width="400" height="400"></canvas>
            </div>
        </div>
            <script>
            //script para desplegar el aside
               document.addEventListener("alpine:init", () => {
        Alpine.data("layout", () => ({
            profileOpen: false,
            asideOpen: true,
        }));
    });
            // obtener la cookie del usuario que inicio sesion
            document.addEventListener('DOMContentLoaded', function() {
                var username = getCookie('username');
                if (username) {
                    var usernameDisplay = document.getElementById('usernameDisplay');
                    usernameDisplay.textContent = username;
                }
            });
            //funcion para extraer al que inicio sesion y obtener su imagen
        document.addEventListener('DOMContentLoaded', function () {
            var nombreimagen = getCookie('nombreimagen');
            if (nombreimagen) {
                var imagenElement = document.getElementById('imagen');
                imagenElement.src = "../../fotos_perfil/" + nombreimagen;
                
                var profileImageElement = document.getElementById('profileImage');
                profileImageElement.src = "../../fotos_perfil/" + nombreimagen;
            } else {
                var imagenElement = document.getElementById('imagen');
                imagenElement.src = "../../fotos_perfil/usuario.jpg"; // Puedes proporcionar una imagen predeterminada en caso de que no haya ninguna imagen de perfil
                 var imagenElement = document.getElementById('profileImage');
                profileImageElement.src = "../../fotos_perfil/usuario.jpg"; // Puedes proporcionar una imagen predeterminada en caso de que no haya ninguna imagen de perfil
            }
        });
        //funcion para obtener cookie
        function getCookie(name) {
            var value = "; " + document.cookie;
            var parts = value.split("; " + name + "=");
            if (parts.length === 2) return parts.pop().split(";").shift();
        }
// Recuperar los datos del archivo PHP
        fetch('../php/grafica.php')
            .then(response => response.json())
            .then(data => {
                // Procesar los datos
                const labels = data.map(item => item.hora);
                const values = data.map(item => item.temperatura);

                // Crear el gráfico de barras
                const ctx = document.getElementById('myChart').getContext('2d');
                const myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Temperatura por Hora',
                            data: values,
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true,
                                min: 17, // Aquí puedes establecer el límite inferior para el eje y
                                max:35, // Aquí puedes establecer el límite superior para el eje y
                                title: {
                                    display: true,
                                    text: 'Temperatura' // Aquí puedes agregar la etiqueta para el eje y
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Hora' // Aquí puedes agregar la etiqueta para el eje x
                                }
                            }
                        }
                    }
                });
            })
            .catch(error => console.error('Error:', error));
            </script>
        </div>
    </main>
</body>
</html>
